# UI Team - Enhanced Exercise Delivery Specification

## Date: 2026-01-21
## From: UI Team
## To: API Team
## Priority: Medium
## Related Specs: ASSESSMENT_MODULE_SPEC.md, UNIFIED_CONTENT_HIERARCHY_SPEC.md

---

## Terminology Update

| Term | Definition |
|------|------------|
| **Module** | A logical grouping of learning units within a course |
| **LearningUnit** | A single piece of content/activity within a module (formerly "CourseModule") |

**Note:** This spec is part of the unified hierarchy. See also:
- `UI-2026-01-21-module-entity-request.md`
- `UI-2026-01-21-entity-modifications-request.md`

---

## Summary

We need enhanced exercise types and rich media support. Exercises are for practice/learning (distinct from Assessments which are formal evaluations).

## Specification Document

Full specification available at: `specs/ENHANCED_EXERCISE_DELIVERY_SPEC.md`

---

## Key Requirements

### 1. New Exercise Types

Update `ExerciseType` enum:

```typescript
type ExerciseType =
  | 'practice'           // General practice (existing)
  | 'flashcard'          // Card-based memorization with spaced repetition
  | 'matching'           // Drag-and-drop matching columns
  | 'finish_the_story';  // Prose completion with AI-assisted scoring
```

### 2. Flashcard Exercise

- Front/back card format
- Self-assessment (Got it / Need practice)
- Spaced repetition algorithm (SM-2) for scheduling
- Progress tracking per user

### 3. Matching Exercise

- Column A: prompts (fixed)
- Column B: answers (draggable)
- Visual feedback on correct/incorrect matches
- Supports text and/or images in both columns

### 4. Finish the Story Exercise

- Present scenario with prompt
- Learner writes prose response
- Scoring via:
  - Required/bonus keyword matching
  - AI analysis (coherence, relevance, completeness)
- Hybrid score combining keywords + AI

---

## Rich Media Support

All exercises can include images, videos, and audio in questions/answers.

### Media Constraints

| Type | Max Size | Max Duration | Formats |
|------|----------|--------------|---------|
| Image | 10 MB | N/A | JPEG, PNG, GIF, WebP, SVG |
| Video | 100 MB | 5 minutes | MP4, WebM |
| Audio | 20 MB | 5 minutes | MP3, WAV, OGG, M4A |

### Storage

- Store in configured S3/Spaces/CDN bucket
- Store `storageKey` (bucket path) and `cdnUrl` (delivery URL)
- Support presigned upload URLs for direct client upload
- Post-upload processing for thumbnails, transcoding, metadata extraction

---

## New API Endpoints Required

### Media Endpoints

```
POST   /api/v2/media/upload-url     # Get presigned upload URL
POST   /api/v2/media/confirm        # Confirm upload, process media
GET    /api/v2/media/:mediaId       # Get media details
DELETE /api/v2/media/:mediaId       # Delete media
GET    /api/v2/exercises/:id/media  # List media for exercise
```

### Flashcard Endpoints

```
GET    /api/v2/exercises/:id/flashcard-session    # Get cards with spaced repetition
POST   /api/v2/exercises/:id/flashcard-result     # Record card result
GET    /api/v2/exercises/:id/flashcard-progress   # Get user progress
DELETE /api/v2/exercises/:id/flashcard-progress   # Reset progress
```

### AI Scoring Endpoint

```
POST   /api/v2/exercises/score-prose
Body: { promptId, response, exerciseId }
Response: AiScoringResult
```

---

## New Collections Required

### Media Collection

```javascript
{
  storageKey: String,      // unique key in bucket
  cdnUrl: String,          // public delivery URL
  type: 'image' | 'video' | 'audio',
  filename: String,
  mimeType: String,
  fileSize: Number,
  width: Number,           // for image/video
  height: Number,
  duration: Number,        // for video/audio (seconds)
  altText: String,
  transcript: String,
  uploadedBy: ObjectId,
  uploadedAt: Date,
  exerciseId: ObjectId,
  purpose: 'question' | 'answer' | 'hint' | 'explanation'
}
```

### FlashcardProgress Collection

```javascript
{
  userId: ObjectId,
  exerciseId: ObjectId,
  cardId: String,
  timesCorrect: Number,
  timesIncorrect: Number,
  lastReviewed: Date,
  nextReviewDate: Date,
  mastered: Boolean,
  easeFactor: Number       // for SM-2 algorithm
}
```

---

## Questions for API Team

1. **Storage Provider**: Which provider should we configure first? AWS S3, DigitalOcean Spaces, or Cloudflare R2?

2. **AI Scoring**: Should AI scoring be a separate microservice, or integrated into the main API? What's the preferred provider (OpenAI, Anthropic)?

3. **Media Processing**: Should we use a queue (Bull/Redis) for post-upload processing, or handle synchronously for small files?

4. **Spaced Repetition**: Should the algorithm run server-side (more accurate) or client-side (faster)?

---

*This message was generated by the UI development team*
