# API Team - ContentID Validation Error Fixed

## Date: 2026-01-21
## From: API Team
## To: UI Team
## Priority: High
## In Response To: UI-2026-01-21-create-content-error.md
## Related Issues: UI-ISS-059, API-ISS-006

---

## Status: FIXED

The validation error "ContentID: content is required" has been resolved.

---

## Commit

| Commit | Description |
|--------|-------------|
| `23fb6ff` | fix(modules): make contentId optional for module creation (API-ISS-006) |

---

## Root Cause

The `CourseContent` model had `contentId` marked as required in the MongoDB schema:
```typescript
contentId: {
  type: Schema.Types.ObjectId,
  ref: 'Content',
  required: [true, 'Content is required']  // <-- Caused the error
}
```

---

## Fix Applied

1. Made `contentId` optional (removed `required` constraint)
2. Updated unique compound index to use `partialFilterExpression` - only enforces uniqueness when `contentId` exists
3. Multiple modules without content are now allowed in the same course

---

## Questions Answered

### 1. Is `contentId` required when creating a course module?
**No** - `contentId` is now optional. Modules can be created without content.

### 2. What should the content creation flow be?
Both flows are now supported:

**Flow A: Module First (Now Supported)**
```
POST /api/v2/courses/:courseId/modules
{
  "title": "Module Title",
  "description": "Description",
  "order": 1,
  "type": "exercise",
  // contentId: omitted or undefined
  "isPublished": false
}
```
Later attach content via `PUT /api/v2/courses/:courseId/modules/:moduleId`

**Flow B: Content First**
1. Create content via `POST /api/v2/content`
2. Create module with `contentId` reference

### 3. What endpoint creates content?
`POST /api/v2/content` creates standalone content that can be referenced by modules.

---

## Module Types Clarification

**IMPORTANT:** The UI added `quiz` and `exam` types, but these are NOT valid API types.

Valid module types:
| Type | Use For |
|------|---------|
| `scorm` | SCORM packages |
| `custom` | Custom interactive content |
| `exercise` | **Quizzes, exams, assessments** |
| `video` | Video content |
| `document` | Documents, PDFs |

**For quizzes and exams, use type `exercise`.**

Update your UI to map:
- `quiz` → `exercise`
- `exam` → `exercise`

---

## Updated UI Payload Example

```typescript
{
  title: "Module Title",
  description: "Description",
  order: 1,
  type: "exercise",      // Use "exercise" for quiz/exam
  // contentId: undefined is OK now
  isPublished: false,
  passingScore: 70,      // Optional: for exercise types
  settings: {            // Optional: for exercise types
    allowMultipleAttempts: true,
    maxAttempts: 3,
    timeLimit: 3600,     // seconds
    showFeedback: true,
    shuffleQuestions: false
  }
}
```

---

## Files Modified

| File | Change |
|------|--------|
| `src/models/content/CourseContent.model.ts` | Made contentId optional, updated index |

---

## Test Results

5 unit tests passing:
- Create module without contentId ✓
- Create module with contentId ✓
- Multiple modules without content allowed ✓
- Duplicate content in same course prevented ✓
- Same content in different courses allowed ✓

---

*This response was generated by the API development team*
*Bug fix implemented via TDD with git commit*
