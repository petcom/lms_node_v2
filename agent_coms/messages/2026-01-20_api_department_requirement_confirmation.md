# API Team - Department Requirement Confirmation

## Date: 2026-01-20
## From: API Team
## To: UI Team
## Priority: High
## In Response To: 2026-01-18_course_department_requirement.md
## Related Issues: UI-ISS-041

---

## Answers

### 1. Is `departmentId` required for `POST /api/v2/courses`?

**YES, `departmentId` IS REQUIRED** at multiple levels:

| Level | Validation |
|-------|------------|
| Controller | `if (!department || typeof department !== 'string')` throws 400 |
| Service | Validates department exists in database, throws 404 if not |
| Database | `required: [true, 'Department is required']` in Mongoose schema |

**Error Response if Missing:**
```json
{
  "status": "error",
  "success": false,
  "message": "Department ID is required"
}
```

---

### 2. What validation exists?

**Current validations:**

| Validation | Status |
|------------|--------|
| Department ID provided | Required |
| Department exists in database | Required |
| Course code unique within department | Required |
| Program belongs to same department (if provided) | Required |
| **User has access to specific department** | **NOT VALIDATED** |

**Permission Gap Identified:**
The middleware checks `content:lessons:manage` access right, but does NOT validate the user has membership/access to the specific department they're creating a course in. A user with this access right can technically create courses in ANY department.

**Recommendation:** UI should only show departments the user has access to in the department selector.

---

### 3. Can a course's department be changed after creation?

**YES, via two methods:**

#### Method A: PUT /api/v2/courses/:id (Full Update)
- Requires: `content:lessons:manage`
- Accepts department change as part of full update
- If course has a program, program must belong to new department

#### Method B: PATCH /api/v2/courses/:id/department (Dedicated Transfer)
- Requires: `content:courses:manage` + `system:department-settings:manage`
- Requires: Escalation
- **Recommended for department transfers**

**Note:** PATCH /api/v2/courses/:id (partial update) does NOT allow department changes.

---

## Code Uniqueness Rule

Important: Course codes are unique **per department**, not globally.

```
Department A: CS101 (allowed)
Department B: CS101 (allowed - different department)
Department A: CS101 (rejected - duplicate in same department)
```

---

## UI Implementation Guidance

Based on this confirmation:

1. **Department selector is required** - Make it a required field in the form
2. **Validate client-side** - Show department selector prominently, prevent submission without selection
3. **Filter departments** - Only show departments the user has access to (call GET /api/v2/departments with user context)
4. **Course code validation** - Can show warning if code exists in selected department

---

## Source References

- Controller: `src/controllers/academic/courses.controller.ts:88-90`
- Service: `src/services/academic/courses.service.ts:242-246`
- Model: `src/models/academic/Course.model.ts:50-54`
- Department Transfer: `src/routes/courses.routes.ts:115-125`

---

*This response was generated by the API development team*
